<?xml version="1.0" ?>
<robot name="twd_lidar_robot" xmlns:xacro="http://ros.org/wiki/xacro">

    <!-- ************************************* ROBOT CONSTANTS ************************************-->
    <!-- Define the size of the robot's main chassis in meters-->
    <!-- <xacro:property name="base_width" value="0.11"/>
    <xacro:property name="base_length" value="0.21"/>
    <xacro:property name="base_height" value="0.002"/> -->

    <!-- Define the shape of the robot's two back wheels in metres-->
    <!-- <xacro:property name="wheel_radius" value="0.0325"/>
    <xacro:property name="wheel_width" value="0.025"/> -->

    <!-- x-axis points forward, y-axis points to left, z-axis points upwards -->
    <!-- Define the gap between the wheel and chassis along y-axis in meters -->
    <!-- <xacro:property name="wheel_ygap" value="0.003"/> -->

    <!-- Position the wheels along the z-axis -->
    <!-- <xacro:property name="wheel_zoff" value="0.0125"/> -->

    <!-- Position the wheels along the x-axis -->
    <xacro:property name="wheel_xoff" value="0.221"/>

    <!-- Position the caster wheel along the x-axis -->
    <xacro:property name="caster_xoff" value="0.217"/>

    <!-- ******************************** ROBOT BASE FOOTPRINT ************************************-->
    <!-- Define the centre of the main robot chassis projected on the ground -->
    <link name="base_footprint"/>

    <!-- The base footprint of the robot is located underneath the chassis/robot base  -->
    <joint name="base_joint" type="fixed">
      <parent link="base_footprint"/>
      <child link="base_link"/>
      <!-- z value = wheel_radius + wheel_zoff. The origin is for the child link with the parent link as
      reference -->
      <origin xyz="0 0 0.045" rpy="0 0 0"/>
    </joint>
    
    <!-- ******************************* ROBOT BASE/CHASSIS ************************************** -->
    <link name="base_link">
        <visual>
          <!-- why 0.0125 (the wheel_zoff value)? I think I intuitively understand why -->
          <origin xyz="0 0 -0.0125" rpy="0 0 0"/>
            <geometry>
                <mesh filename="package://twd_lidar_robot/meshes/robot_base_link.dae" />
            </geometry>
        </visual>

        <collision>
          <geometry>
            <box size="0.21 0.11 0.002"/>
          </geometry>
        </collision>

                <!-- Caster mount -->
        <!-- SORT OUT BELOW -->
        <visual>
          <!-- z is -0.035 plus half the caster mount height uncomment below-->
          <origin xyz="0 0 -0.04125" rpy="0 0 0"/>
          <!-- <origin xyz="0 0 -0.035" rpy="0 0 0"/> -->
          <geometry>
            <mesh filename="package://twd_lidar_robot/meshes/caster_mount.dae" />
          </geometry>
        </visual>

        <collision>
          <geometry>
            <cylinder radius="0.017" length="0.0125"/>
          </geometry>
        </collision>

        <!-- rpi 4 -->
        <!-- SORT OUT BELOW -->
        <visual>
          <origin xyz="-0.05 0 0.002" rpy="0 0 1.5707"/>
          <!-- <origin xyz="0 0 0" rpy="0 0 1.5707"/> -->
          <geometry>
            <mesh filename="package://twd_lidar_robot/meshes/rpi_4.dae"/>
          </geometry>
        </visual>
  
        <collision>
          <geometry>
            <box size="0.085 0.056 0.018"/>
          </geometry>
        </collision>

      <!-- Rplidar base -->
      <!-- SORT OUT BELOW -->
        <visual>
            <!-- half the height of box + half the size of chassis thickness-->
          <origin xyz="0 0 -0.0185" rpy="0 0 3.142"/>
            <geometry>
              <mesh filename="package://twd_lidar_robot/meshes/rplidar_base.dae"/>
            </geometry>
          </visual>

        <collision>
          <geometry>
            <box size="0.0968 0.07 0.035"/>
          </geometry>
        </collision>
    </link>

    <!-- <gazebo reference="base_link">
      <material name="red">
        <color rgba="0.8 0.0 0.0 1.0"/>
      </material>
    </gazebo> -->

    <!-- *************************************** DRIVE WHEELS *********************************************-->
    <link name="left_wheel">
      <visual>
        <!-- y value is moved by half the width of the wheel to place it at the joint origin  -->
        <origin xyz="0 -0.0125 0" rpy="0 1.5707 1.5707"/>
          <geometry>
            <mesh filename="package://twd_lidar_robot/meshes/left_wheel.dae" />
          </geometry>
      </visual>

      <collision>
        <geometry>
          <cylinder radius="0.0325" length="0.025"/>
        </geometry>
      </collision>
    </link>

    <joint name="left_wheel_hinge" type="revolute">
      <parent link="base_link"/>
      <child link="left_wheel"/>
      <!-- joint origin, -0.0125 is the wheel_zoffset  -->
      <!-- used half of wheel width and add to 0.055 for y -->
      <origin xyz="-0.028 0.0675 -0.0125" rpy="0 0 0"/>
      <!-- <origin xyz="-0.028 0.0675 0" rpy="0 0 0"/> -->


      <!-- <origin xyz="-0.028 0.055 -0.0125" rpy="0 0 0"/> -->

      <!-- effort (float) – The maximum joint effort (N for prismatic joints, Nm for revolute).
      velocity (float) – The maximum joint velocity (m/s for prismatic joints, rad/s for revolute).
      lower (float, optional) – The lower joint limit (m for prismatic joints, rad for revolute).
      upper (float, optional) – The upper joint limit (m for prismatic joints, rad for revolute). -->

      <limit upper="3.1415" lower="-3.1415" effort="30" velocity="5.0"/>
      <axis xyz="0 1 0"/>
    </joint>

    <link name="right_wheel">
      <visual>
        <!-- right wheel origin  -->
        <origin xyz="0 0.0125 0" rpy="0 -1.5707 1.5707"/>
        <geometry>
          <mesh filename="package://twd_lidar_robot/meshes/left_wheel.dae" />
        </geometry>
      </visual>

      <collision>
        <geometry>
          <cylinder radius="0.0325" length="0.025"/>
        </geometry>
      </collision>
    </link>

    <joint name="right_wheel_hinge" type="revolute">
      <parent link="base_link"/>
      <child link="right_wheel"/>
      <!-- joint origin  -->
      <origin xyz="-0.028 -0.0675 -0.0125" rpy="0 0 0"/>
      <!-- <origin xyz="-0.028 -0.055 -0.0125" rpy="0 0 0"/> -->
      <limit upper="3.1415" lower="-3.1415" effort="30" velocity="5.0"/>
      <axis xyz="0 1 0"/>
    </joint>

    <!-- ****************************** CASTER MOUNT AND WHEEL ************************************* -->
 <!-- Caster wheel -->
  <link name="caster_wheel">
    <visual>
      <!-- z is half the caster mount and half the radius of the "sphere" of the caster wheel -->
      <origin xyz="0 0 -0.01875" rpy="0 0 1.5707"/>
      <geometry>
        <mesh filename="package://twd_lidar_robot/meshes/caster_wheel.dae"/>
      </geometry>
    </visual>

    <collision>
      <geometry>
        <sphere radius="0.025"/>
      </geometry>
    </collision>
  </link>

  <gazebo reference="caster_wheel">
    <mu1>0.01</mu1>
    <mu2>0.01</mu2>
  </gazebo>

  <joint name="caster_wheel_to_base" type="revolute">
    <parent link="base_link"/>
    <child link="caster_wheel"/>
    <!-- SORT OUT BELOW -->
    <origin xyz="0 0 -0.01875" rpy="0 0 0"/>
    <!-- <origin xyz="0 0 -0.035" rpy="0 0 0"/> -->
    <limit upper="3.1415" lower="-3.1415" effort="30" velocity="5.0"/>
    <axis xyz="0 0 1"/>
  </joint>

  <!-- RPLidar top link-->
  <link name='rplidar_top'>
    <visual>
    <!-- z is half the distance of the height of the cylinder -->
      <origin xyz="0 0 -0.0105" rpy="0 0 1.0707"/>
      <geometry>
        <mesh filename="package://twd_lidar_robot/meshes/rplidar_top.dae"/>
      </geometry>
    </visual> 
    
    <collision>
      <geometry>
        <cylinder radius="0.035" length="0.021"/>
        <!-- <cylinder radius="0.035" length="0.0195"/> -->
      </geometry>
    </collision>

    <inertial>
      <mass value="0.07" />
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="0.00002298" ixy="0" ixz="0" iyy="0.00002298" iyz="0" izz="0.00004288" />
    </inertial>
  </link>

  <joint name="rplidar_joint" type="revolute">
    <parent link="base_link"/>
    <child link="rplidar_top"/>
    <!-- half height of rplidar base + half height of rplidar top -->
    <origin xyz="0 0.0027 0.028" rpy="0 0 0"/>
    <!-- adjust figures later -->
    <limit upper="100000000000000" lower="-100000000000000" effort="30" velocity="5"/>
    <!-- The axis defines the joint's degree of freedom, revolve around the z-axis -->
    <axis xyz="0 0 1"/>
  </joint>
</robot>


<!-- Comment each section well, for me and others as well -->

<!-- Xacro after we get this basic one working, then push to github -->

<!-- Can we make the dae files more solid using gazebo tags maybe?  -->
